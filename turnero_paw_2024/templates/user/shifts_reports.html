{% extends 'base.html' %}
{% load static %}
{% block title %}Reportes{% endblock title %}
{% block links %}
<link rel="preload" href="{% static 'css/reset.css' %}" 
            as="style" onload="this.onload=null;this.rel='stylesheet'">
<link rel="preload" href="{% static 'css/base.css' %}" 
            as="style" onload="this.onload=null;this.rel='stylesheet'">
<link rel="preload" href="{% static 'css/header.css' %}" 
            as="style" onload="this.onload=null;this.rel='stylesheet'"> 
<link rel="preload" href="{% static 'css/user/shifts-reports.css' %}" 
            as="style" onload="this.onload=null;this.rel='stylesheet'">   
<link rel="preload" href="{% static 'css/shift/modal_shift_details.css' %}" 
            as="style" onload="this.onload=null;this.rel='stylesheet'">
{% endblock links %}
{% block content %}
    {% include 'includes/header.html' with show_nav=True show_avatar_user=True %}

    <section class="shifts-reports-container">
        <h2 class="shifts-reports-container__title">Reportes</h2>
        <form id="filter-form">
            {% csrf_token %}
            <label for="start-date">Fecha Desde:</label>
            <input type="date" id="start-date" name="start-date">

            <label for="end-date">Fecha Hasta:</label>
            <input type="date" id="end-date" name="end-date">
    
            <label for="state">Estado:</label>
            <select id="state" name="state">
                <option class="state-option" value="" selected>
                    Seleccionar Estado
                </option>
                {% for state in states %}
                    <option class="state-option" value="{{ state.short_description }}">
                        {{ state.description }}
                    </option>
                {% endfor %}
            </select>
    
            <button type="submit">Filtrar</button>
        </form>
        <section class="shifts-reports-container__table-section">
            <table id="shifts-table" class="shifts-table">
                <thead id="shifts-table__thead">
                    <tr>
                        <th>Fecha</th>
                        <th>Hora</th>
                        <th>Persona</th>
                        <th>Operador Asignado</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody id="shifts-table__tbody">
                    {% if not page_obj %}
                        <td>-</td>  
                        <td>-</td> 
                        <td>-</td> 
                        <td>-</td>  
                        <td>-</td>  
                    {% else %}
                        {% for shift in page_obj %}
                            <tr>
                                <td>{{ shift.date }}</td>
                                <td>{{ shift.hour }}</td>
                                <td>{{ shift.id_person }}</td>
                                {% if shift.id_state.short_description == 'confirmado' %}
                                    <td>{{ shift.id_person.id_user.username }}</td>
                                {% else %}
                                    <td>Sin Asignar</td>   
                                {% endif %}
                                <td>{{ shift.id_state.description }}</td>
                            </tr>
                        {% endfor %}
                    {% endif %}
                </tbody>
            </table>
            {% include 'includes/pagination.html' %}   
            <button id="export-button">
                Exportar Tabla
            </button>
        </section>
    </section>    

{% include 'includes/footer.html' %}
    <script type="module" src="{% static 'js/menu.js' %}" ></script>
    <script src="{% static 'js/shift/generate_reports.js' %}" defer></script>
    {{ query_number|json_script:"queryNumber" }} 

{% endblock content %}