{% extends 'base.html' %}
{% load static %}
{% block title %}Reportes{% endblock title %}
{% block links %}
<link rel="preload" href="{% static 'css/header.css' %}" 
            as="style" onload="this.onload=null;this.rel='stylesheet'">
<link rel="preload" href="{% static 'css/user/user-home.css' %}" 
            as="style" onload="this.onload=null;this.rel='stylesheet'">   
<link rel="preload" href="{% static 'css/shift/modal_shift_details.css' %}" 
            as="style" onload="this.onload=null;this.rel='stylesheet'">
{% endblock links %}
{% block content %}
    {% include 'includes/header.html' with show_nav=True show_avatar_user=True %}

    <section>
        <h1>Reportes</h1>
        <form id="filter-form">
            {% csrf_token %}
            <label for="start-date">Fecha Desde:</label>
            <input type="date" id="start-date" name="start-date">
    
            <label for="end-date">Fecha Hasta:</label>
            <input type="date" id="end-date" name="end-date">
    
            <label for="state">Estado:</label>
            <select id="state" name="state">
                <option value="">Seleccionar Estado</option>
                {% for state in states %}
                    <option value="{{ state.short_description }}">{{ state.description }}</option>
                {% endfor %}
            </select>
    
            <button type="submit">Filtrar</button>
        </form>
        <table id="shifts-table">
            <thead id="shifts-table__thead">
                <tr>
                    <th>Fecha</th>
                    <th>Hora</th>
                    <th>Persona</th>
                    <th>Operador Asignado</th>
                </tr>
            </thead>
            <tbody id="shifts-table__tbody">
                {% for shift in page_obj %}
                    <tr>
                        <td>{{ shift.date }}</td>
                        <td>{{ shift.hour }}</td>
                        <td>{{ shift.id_person }}</td>
                        {% if shift.id_state.short_description == 'confirmado' %}
                            <td>{{ shift.id_person.id_user.username }}</td>
                        {% else %}
                            <td>Sin Asignar</td>   
                        {% endif %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        {% include 'includes/pagination.html' %}

        <button id="export-button">
            Exportar Tabla
        </button>
    </section>    

{% include 'includes/footer.html' %}
    <script type="module" src="{% static 'js/menu.js' %}" ></script>
    <script src="{% static 'js/shift/generate_reports.js' %}" defer></script>
    {{ query_number|json_script:"queryNumber" }}
{% endblock content %}